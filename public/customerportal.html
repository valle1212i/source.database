<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kundportal - Startsida</title>
  <link rel="stylesheet" href="CSS/customerportal.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="sidebar">
    <div class="logo">
      <h2>Source</h2>
    </div>
    <div class="sidebar">
  <div class="logo">
    <h2>Source</h2>
  </div>
  <ul class="nav-menu">
    <li class="active">
      <a href="customerportal.html"><i class="fas fa-home"></i> Hem</a>
    </li>
    <li>
      <a href="betalningar.html"><i class="fas fa-credit-card"></i> Betalningar</a>
    </li>
    <li>
      <a href="kontakt.html"><i class="fas fa-envelope"></i> Kontakt</a>
    </li>
    <li>
      <a href="rapporter.html"><i class="fas fa-chart-line"></i> Rapporter</a>
    </li>
    <li>
      <a href="fakturor.html"><i class="fas fa-file-invoice"></i> Fakturor</a>
    </li>
    <li>
      <a href="kunder.html"><i class="fas fa-users"></i> Kunder</a>
    </li>
    <li>
      <a href="analytics.html"><i class="fas fa-chart-pie"></i> Analyser</a>
    </li>
    <li>
      <a href="inventarier.html"><i class="fas fa-box"></i> Inventarier</a>
    </li>
    <li>
      <a href="installningar.html"><i class="fas fa-cog"></i> Inst√§llningar</a>
    </li>
  </ul>
  <div class="help">
    <a href="faq.html"><i class="fas fa-question-circle"></i> Hj√§lp</a>
  </div>
</div>
  </div>

  <div class="main">
    <div class="header">V√§lkommen tillbaka, Anna!</div>

    <div class="grid">
      <!-- F√∂rs√§ljning med diagram och belopp -->
      <div class="card circle-widget">
        <div class="chart-area">
          <canvas id="salesChart"></canvas>
        </div>
        <div class="sales-info">
          <h3>F√∂rs√§ljning senaste 7 dagarna</h3>
          <hr class="title-underline" />
          <div class="amount">752,000 SEK</div>
          <hr class="amount-underline" />
        </div>
      </div>
<div class="card">
  <h3>Tidigare √§renden via v√•r support</h3>
  <div class="table-container">
    <table class="support-table">
      <thead>
        <tr>
          <th>√Ñrende-ID</th>
          <th>Datum</th>
          <th>Kundnamn</th>
          <th>√Ñrende</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>#10234</td>
          <td>2025-06-24</td>
          <td>Anna Svensson</td>
          <td>Problem med inloggning</td>
          <td><span class="status-text closed">Avslutat</span></td>
        </tr>
        <tr>
          <td>#10235</td>
          <td>2025-06-24</td>
          <td>Erik Johansson</td>
          <td>Fakturafr√•ga</td>
          <td><span class="status-text closed">Avslutat</span></td>
        </tr>
        <tr>
          <td>#10236</td>
          <td>2025-06-25</td>
          <td>Maria Nilsson</td>
          <td>Buggrapport</td>
          <td><span class="status-text progress">P√•g√•ende</span></td>
        </tr>
        <tr>
          <td>#10237</td>
          <td>2025-06-25</td>
          <td>Jonas Berg</td>
          <td>Uppdatering av konto</td>
          <td><span class="status-text closed">Avslutat</span></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
  <div class="card">
  <h3>AI rekommenderade v√§xningsm√∂jligheter</h3>
  <ul class="growth-list">
    <li>Starta kampanj i ny kanal (t.ex. TikTok)</li>
    <li>Skapa lojalitetsprogram</li>
    <li>Optimera nyhetsbrev med segmenterade utskick</li>
    <li>F√∂rb√§ttra SEO p√• produktsidor</li>
    <li>Retargeting-kampanj f√∂r √∂vergivna varukorgar</li>
    <li>Lansera produktbundle-erbjudanden</li>
    <li>Uppdatera startsidans design</li>
    <li>Erbjud nya betalningsmetoder (Swish, Klarna)</li>
  </ul>
</div>
<div class="card latest-message">
  <div class="card-header aligned">
    <i class="fas fa-comments chat-icon"></i>
    <h3>Senaste meddelande fr√•n kund</h3>
  </div>
  <div class="chat-bubble">
    Jag vill veta status p√• min order #10235.
    <div class="message-meta">
      <span class="customer-name">Anna Svensson</span> ¬∑ 
      <span class="timestamp">2025-06-30, kl. 14:12</span>
    </div>
  </div>
</div> <!-- üîß DENNA saknades -->

<div class="card">
  <h3>Visningar p√• hemsidan</h3>
  <div class="mini-chart-container">
    <canvas id="websiteViewsMiniChart" height="60"></canvas>
  </div>
  <div class="chart-indicator-box">
  <span class="change">+12% senaste veckan</span>
  <span class="total"><strong>28 000 visningar idag</strong></span>
</div>
</div>
      <div class="card">
        <h3>Mest k√∂pt produkt</h3>
        <p>Pro Plus-paketet</p>
      </div>

      <div class="card">
        <h3>Totalt antal ordrar</h3>
        <p>1 820 ordrar registrerade</p>
      </div>

      <div class="card">
        <h3>Utbetalningar</h3>
        <p>Senaste: 215 000 SEK den 20 juni</p>
      </div>

      <div class="card">
        <h3>Senaste order</h3>
        <p>Order #1820 - levererad 24 juni</p>
      </div>

      <div class="card">
        <h3>AI Insights</h3>
        <ul>
          <li>Optimera onboardingfl√∂de</li>
          <li>F√∂rb√§ttra e-postkampanjer</li>
          <li>Identifiera kundbortfall</li>
        </ul>
      </div>

      <div class="card">
        <h3>Kommande m√∂ten</h3>
        <p>N√§sta m√∂te: 27 juni kl. 14:00</p>
        <p>M√∂te med marknadsteamet</p>
      </div>

      <div class="card live-chat dark">
        <h3>Live Chat</h3>
        <p>"Kan du skicka senaste rapporten?" - kund</p>
        <button id="startChatBtn">Starta chatt med oss</button>
      </div>
      
      <div class="card">
        <h3>Support√§renden</h3>
        <ul>
          <li>Inloggningsproblem - <span class="status open">√ñppen</span></li>
          <li>Buggrapport - <span class="status progress">P√•g√•r</span></li>
          <li>Funktion√∂nskem√•l - <span class="status closed">St√§ngd</span></li>
        </ul>
      </div>

      <div class="card ai-assistant">
        <h3><i class="fas fa-robot"></i> AI Assistent</h3>
        <p>F√∂resl√•r svar, ger analyser och hj√§lp i realtid.</p>

        <textarea id="aiMessage" rows="3" placeholder="St√§ll en fr√•ga till AI..."></textarea><br>
        <button onclick="askAI()">Skicka fr√•ga</button>
        <div id="aiResponse" style="margin-top: 10px; padding: 8px; background-color: #f5f5f5; border-radius: 4px;"></div>
      </div>

    </div>
  </div>

  <!-- Chart.js -->
  <script>
    const ctx = document.getElementById('salesChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['M√•n', 'Tis', 'Ons', 'Tors', 'Fre', 'L√∂r', 'S√∂n'],
        datasets: [{
          label: 'F√∂rs√§ljning (SEK)',
          data: [120000, 95000, 110000, 87000, 98000, 102000, 140000],
          backgroundColor: '#111827'
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { color: '#6b7280' } },
          y: {
            beginAtZero: true,
            ticks: { color: '#6b7280' }
          }
        }
      }
    });
  </script>

<script>
  // F√∂rs√§ljningsdiagram
  const ctxSales = document.getElementById('salesChart').getContext('2d');
  new Chart(ctxSales, {
    type: 'bar',
    data: {
      labels: ['M√•n', 'Tis', 'Ons', 'Tors', 'Fre', 'L√∂r', 'S√∂n'],
      datasets: [{
        label: 'F√∂rs√§ljning (SEK)',
        data: [120000, 95000, 110000, 87000, 98000, 102000, 140000],
        backgroundColor: '#111827'
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: '#6b7280' } },
        y: {
          beginAtZero: true,
          ticks: { color: '#6b7280' }
        }
      }
    }
  });
  </script>
 <script>
  const miniCtx = document.getElementById('websiteViewsMiniChart').getContext('2d');

  new Chart(miniCtx, {
    type: 'line',
    data: {
      labels: ['M√•n', 'Tis', 'Ons', 'Tors', 'Fre', 'L√∂r', 'S√∂n'],
      datasets: [{
        label: 'Visningar',
        data: [13400, 19800, 22000, 18000, 24000, 19500, 26500],
        borderColor: '#3b82f6',
        backgroundColor: 'rgba(59, 130, 246, 0.08)',
        fill: true,
        tension: 0.4,
        pointRadius: 0,           // Fortfarande osynliga
        pointHitRadius: 10,       // Men tooltip fungerar!
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          enabled: true,
          backgroundColor: '#111827',
          titleColor: '#ffffff',
          bodyColor: '#d1d5db',
          callbacks: {
            label: function (context) {
              return context.parsed.y + ' visningar';
            }
          }
        }
      },
      scales: {
        x: {
          display: false
        },
        y: {
          display: false
        }
      }
    }
  });
</script>
<script>
  async function askAI() {
    const message = document.getElementById("aiMessage").value;
    const responseDiv = document.getElementById("aiResponse");
    if (!message) {
      responseDiv.textContent = "‚ö†Ô∏è V√§nligen skriv en fr√•ga f√∂rst.";
      return;
    }

    responseDiv.textContent = "üîÑ AI t√§nker...";

    try {
      const res = await fetch("/api/chat/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message }),
        credentials: "include"
      });

      const data = await res.json();
      const reply = data.reply || "‚ùå Inget svar fr√•n AI.";

      responseDiv.textContent = "";
      let i = 0;
      const speed = 15;

      function typeChar() {
        if (i < reply.length) {
          responseDiv.textContent += reply.charAt(i);
          i++;
          setTimeout(typeChar, speed);
        }
      }

      typeChar();

    } catch (err) {
      responseDiv.textContent = "‚ùå Det gick inte att kontakta AI-agenten.";
      console.error(err);
    }
  }

  const textarea = document.getElementById("aiMessage");
  textarea.addEventListener("keydown", function (event) {
    if (event.key === "Enter" && !event.shiftKey) {
      event.preventDefault();
      askAI();
    }
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const chatBtn = document.getElementById("startChatBtn");
    const chatWindow = document.getElementById("chatWindow");
    const chatInput = document.getElementById("chatInput");
    const chatMessages = document.getElementById("chatMessages");
  
    if (chatBtn && chatWindow && chatInput && chatMessages) {
      chatBtn.addEventListener("click", () => {
        chatWindow.style.display = "block";
      });
  
      chatInput.addEventListener("keypress", async function (e) {
  if (e.key === "Enter" && chatInput.value.trim() !== "") {
    const message = chatInput.value;

    // Visa direkt i UI
    const msg = document.createElement("div");
    msg.textContent = "Du: " + message;
    chatMessages.appendChild(msg);
    chatInput.value = "";
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // üîÅ Skicka till backend API
    try {
      await fetch("/api/chat/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          customerId: "placeholder", // byt till riktig ID om du har
          message: message,
          sender: "customer"
        })
      });
    } catch (err) {
      console.error("Kunde inte skicka meddelandet:", err);
    }
  }
});
}
});
  </script>  
<div id="chatWindow" style="display:none; position:fixed; bottom:20px; right:20px; width:300px; height:400px; background:#fff; border:1px solid #ccc; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); z-index:1000; padding:10px;">
  <h4>Chatt med support</h4>
  <div id="chatMessages" style="height:300px; overflow-y:auto; margin-bottom:10px;"></div>
  <input type="text" id="chatInput" placeholder="Skriv ett meddelande..." style="width:100%; padding:5px;" />
</div>
</body>
</html>
<script>
  