<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LinkedIn Ads ‚Äì Stegvis</title>
  <link rel="stylesheet" href="CSS/linkedin.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<body>
  <!-- SIDOPANEL -->
  <div class="sidebar">
    <div class="logo">
      <img src="Images/logo.png" alt="Logotyp" class="logo-img"/>
    </div>
    <ul class="nav-menu">
      <li><a href="customerportal.html"><i class="fas fa-home"></i> Hem</a></li>
      <li><a href="googleads.html"><i class="fab fa-google"></i> Google Ads</a></li>
      <li><a href="metaads.html"><i class="fab fa-facebook"></i> Meta Ads</a></li>
      <li><a href="tiktokads.html"><i class="fab fa-tiktok"></i> TikTok Ads</a></li>
      <li><a href="linkedin.html" class="active"><i class="fab fa-linkedin"></i> LinkedIn Ads</a></li>
      <li><a href="aimarknadsstudio.html"><i class="fas fa-magic"></i> AI Studio</a></li>
      <li><a href="radgivning.html"><i class="fas fa-headset"></i> R√•dgivning</a></li>
    </ul>
    <div class="help">
      <a href="faq.html" style="color:#9ca3af; text-decoration:none;">
        <i class="fas fa-circle-question"></i> Hj√§lp / FAQ
      </a>
    </div>
  </div>
  <!-- INNEH√ÖLL -->
  <div class="main-content">
    <a href="marknadsforing.html" class="back-link">&larr; Tillbaka</a>

    <form id="stepForm">
      <div class="progress-text" id="progressText">Steg 1 av 6</div>
      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <!-- Steg 1 -->
      <div class="form-step active">
        <h2>1. Vad √§r syftet med din LinkedIn-kampanj?</h2>
        <div class="options">
          <label><input type="radio" name="q1" value="Leads" required> Generera leads</label>
          <label><input type="radio" name="q1" value="Varum√§rke"> Bygga varum√§rke</label>
          <label><input type="radio" name="q1" value="Rekrytering"> Rekrytering</label>
          <label><input type="radio" name="q1" value="Trafik"> Webbplatstrafik</label>
        </div>
        <button type="button" onclick="nextStep()">N√§sta</button>
      </div>

      <!-- Steg 2 -->
      <div class="form-step">
        <h2>2. Vilken yrkesgrupp vill du n√•?</h2>
        <textarea name="q2" required placeholder="T.ex. HR-chefer, marknadsansvariga, VD:ar..."></textarea>
        <button type="button" onclick="nextStep()">N√§sta</button>
      </div>

      <!-- Steg 3 -->
      <div class="form-step">
        <h2>3. Vad erbjuder du?</h2>
        <textarea name="q3" required placeholder="Produkt, tj√§nst eller l√∂sning du vill marknadsf√∂ra"></textarea>
        <button type="button" onclick="nextStep()">N√§sta</button>
      </div>

      <!-- Steg 4 -->
      <div class="form-step">
        <h2>4. Vilken tonalitet ska annonsen ha?</h2>
        <div class="options">
          <label><input type="radio" name="q4" value="Professionell" required> Professionell</label>
          <label><input type="radio" name="q4" value="Informativ"> Informativ</label>
          <label><input type="radio" name="q4" value="Inspirerande"> Inspirerande</label>
          <label><input type="radio" name="q4" value="Teknisk"> Teknisk & saklig</label>
        </div>
        <button type="button" onclick="nextStep()">N√§sta</button>
      </div>

      <!-- Steg 5 -->
      <div class="form-step">
        <h2>5. Vilken call-to-action vill du ha?</h2>
        <div class="options">
          <label><input type="radio" name="q5" value="Boka demo" required> Boka demo</label>
          <label><input type="radio" name="q5" value="Kontakta oss"> Kontakta oss</label>
          <label><input type="radio" name="q5" value="L√§s mer"> L√§s mer</label>
          <label><input type="radio" name="q5" value="Ladda ner"> Ladda ner guide/rapport</label>
        </div>
        <button type="button" onclick="nextStep()">N√§sta</button>
      </div>

      <!-- Steg 6 -->
      <div class="form-step">
        <h2>6. N√•got mer vi b√∂r veta?</h2>
        <textarea name="q6" placeholder="T.ex. specifik l√§nk, rabattkod, uppladdad PDF..."></textarea>
        <button type="submit">Skicka</button>
      </div>

      <!-- Tack -->
      <div class="form-step" id="thankYouStep">
        <h2>Tack f√∂r din f√∂rfr√•gan! üéâ</h2>
        <p style="margin-top: 16px; font-size: 16px; line-height: 1.6; text-align: center;">
          Din kampanjinfo har skickats till v√•ra experter.<br />
          Vi √•terkommer med ett LinkedIn-f√∂rslag inom kort.<br />
          Du hittar f√∂rfr√•gan under <strong>Analyser</strong>.
        </p>
      </div>
    </form>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let currentStep = 0;
      const steps = document.querySelectorAll(".form-step");
      const progressText = document.getElementById("progressText");

      // H√§mta CSRF-token och skicka cookies i alla anrop
      const csrfTokenPromise = fetch("/csrf-token", { credentials: "include" })
        .then(r => r.ok ? r.json() : null)
        .then(d => d?.csrfToken || null)
        .catch(() => null);

      function updateProgressBar() {
        const totalSteps = steps.length - 1; // exkludera tack-sidan
        const percentage = Math.min((currentStep / totalSteps) * 100, 100);
        document.getElementById("progressBar").style.width = percentage + "%";
        progressText.textContent = `Steg ${Math.min(currentStep + 1, totalSteps)} av ${totalSteps}`;
      }

      function nextStep() {
        const current = steps[currentStep];
        const inputs = current.querySelectorAll("input, textarea");

        for (const input of inputs) {
          if (input.type === "radio") {
            const name = input.name;
            const group = current.querySelectorAll(`input[name="${name}"]`);
            if (![...group].some(i => i.checked)) {
              alert("V√§lj ett alternativ innan du g√•r vidare.");
              return;
            }
          } else if (input.tagName === "TEXTAREA" && input.required && input.value.trim() === "") {
            alert("Fyll i ett svar innan du g√•r vidare.");
            return;
          }
        }

        steps[currentStep].classList.remove("active");
        currentStep++;
        if (steps[currentStep]) {
          steps[currentStep].classList.add("active");
          updateProgressBar();
        }
      }

      function prevStep() {
        if (currentStep > 0) {
          steps[currentStep].classList.remove("active");
          currentStep--;
          steps[currentStep].classList.add("active");
          updateProgressBar();
        }
      }

      document.getElementById("stepForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        try {
          const token = await csrfTokenPromise;
          const res = await fetch("/api/ads/linkedin", {
            method: "POST",
            credentials: "include",
            headers: {
              "Content-Type": "application/json",
              ...(token ? { "x-csrf-token": token } : {})
            },
            body: JSON.stringify(data)
          });

          if (!res.ok) {
            let msg = `Serverfel ${res.status}`;
            try {
              const j = await res.json();
              if (j?.message || j?.error) msg = j.message || j.error;
            } catch {}
            throw new Error(msg);
          }

          // Visa tack-sidan
          steps[currentStep].classList.remove("active");
          currentStep++;
          if (steps[currentStep]) {
            steps[currentStep].classList.add("active");
            updateProgressBar();
          }
        } catch (err) {
          console.error("Fel:", err);
          alert("‚ùå Kunde inte skicka in formul√§ret. " + (err?.message || ""));
        }
      });

      // Exponera f√∂r knapparna i HTML
      window.nextStep = nextStep;
      window.prevStep = prevStep;

      updateProgressBar();
    });
  </script>
</body>
</html>
