<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kunder ‚Äì Kundportal</title>
  <link rel="stylesheet" href="CSS/kunder.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js" defer></script>
</head>
<body>
  <!-- SIDOMENY -->
  <div class="sidebar">
    <div class="logo">
      <h2>Source</h2>
    </div>
  <ul class="nav-menu">
  <li>
    <a href="customerportal.html"><i class="fas fa-home"></i> Hem</a>
  </li>
  <li>
    <a href="betalningar.html"><i class="fas fa-credit-card"></i> Betalningar</a>
  </li>
  <li>
    <a href="kontakt.html"><i class="fas fa-envelope"></i> Kontakt</a>
  </li>
  <li>
    <a href="rapporter.html"><i class="fas fa-chart-line"></i> Rapporter</a>
  </li>
  <li>
    <a href="fakturor.html"><i class="fas fa-file-invoice"></i> Fakturor</a>
  </li>
  <li class="active">
    <a href="kunder.html" class="active"><i class="fas fa-users"></i> Kunder</a>
  </li>
  <li>
    <a href="analytics.html"><i class="fas fa-chart-pie"></i> Analyser</a>
  </li>
  <li>
    <a href="inventarier.html"><i class="fas fa-box"></i> Inventarier</a>
  </li>
  <li>
    <a href="installningar.html"><i class="fas fa-cog"></i> Inst√§llningar</a>
  </li>
</ul>
<div class="help">
  <a href="faq.html"><i class="fas fa-question-circle"></i> Hj√§lp</a>
</div>
  </div>

  <!-- HUVUDINNEH√ÖLL -->
  <main class="main" style="margin-left: 240px; padding: 40px;">
    <h1 class="header">Kundmeddelanden</h1>
    <p class="subtitle">H√§r ser du alla inkommande kund√§renden.</p>

    <!-- S√∂k och meddelandeknapp -->
    <div class="table-header" style="display: flex; gap: 10px; align-items: center;">
      <input type="text" placeholder="üîç S√∂k kundmeddelande..." />
      <button class="message-btn" onclick="openMessageModal()"> Skriv meddelande</button>
    </div>

    <!-- TABELL -->
    <table class="customer-table">
      <thead>
        <tr>
          <th>Kund</th>
          <th>√Ñmne</th>
          <th>Senaste meddelande</th>
          <th>Datum</th>
        </tr>
      </thead>
      <tbody>
      <tbody>
  <tr class="unread" onclick="viewMessage('Anna Karlsson', 'Fr√•ga om leveranstid', 'Hej, n√§r kommer min best√§llning?', '13 maj')">
    <td>Anna Karlsson</td>
    <td>Fr√•ga om leveranstid</td>
    <td>Hej, n√§r kommer min best√§llning?</td>
    <td>13 maj</td>
  </tr>
  <tr onclick="viewMessage('Johan Eriksson', 'Support√§rende: Betalning', 'Jag ser en dubbel transaktion', '12 maj')">
    <td>Johan Eriksson</td>
    <td>Support√§rende: Betalning</td>
    <td>Jag ser en dubbel transaktion</td>
    <td>12 maj</td>
  </tr>
  <tr onclick="viewMessage('Sara Nilsson', 'Kvitto saknas', 'Kan jag f√• mitt kvitto igen?', '10 maj')">
    <td>Sara Nilsson</td>
    <td>Kvitto saknas</td>
    <td>Kan jag f√• mitt kvitto igen?</td>
    <td>10 maj</td>
  </tr>
  <tr class="unread" onclick="viewMessage('Peter Lund', 'Fel p√• produkt', 'Min tr√∂ja hade ett h√•l vid ankomst', '9 maj')">
    <td>Peter Lund</td>
    <td>Fel p√• produkt</td>
    <td>Min tr√∂ja hade ett h√•l vid ankomst</td>
    <td>9 maj</td>
  </tr>
  <tr onclick="viewMessage('Emma Svensson', 'Byte av storlek', 'Hur returnerar jag en vara?', '8 maj')">
    <td>Emma Svensson</td>
    <td>Byte av storlek</td>
    <td>Hur returnerar jag en vara?</td>
    <td>8 maj</td>
  </tr>
  <tr onclick="viewMessage('Oskar Holm', 'Orderbekr√§ftelse saknas', 'Har inte f√•tt n√•gon bekr√§ftelse', '7 maj')">
    <td>Oskar Holm</td>
    <td>Orderbekr√§ftelse saknas</td>
    <td>Har inte f√•tt n√•gon bekr√§ftelse</td>
    <td>7 maj</td>
  </tr>
  <tr class="unread" onclick="viewMessage('Maria Ek', 'Problem med betalning', 'F√•r ett felmeddelande vid checkout', '6 maj')">
    <td>Maria Ek</td>
    <td>Problem med betalning</td>
    <td>F√•r ett felmeddelande vid checkout</td>
    <td>6 maj</td>
  </tr>
  <tr onclick="viewMessage('David Persson', 'Fels√§nd vara', 'Fick fel f√§rg p√• min best√§llning', '5 maj')">
    <td>David Persson</td>
    <td>Fels√§nd vara</td>
    <td>Fick fel f√§rg p√• min best√§llning</td>
    <td>5 maj</td>
  </tr>
  <tr onclick="viewMessage('Lina Fredriksson', 'Rabattkod ej fungerat', 'Koden jag fick fungerade inte', '4 maj')">
    <td>Lina Fredriksson</td>
    <td>Rabattkod ej fungerat</td>
    <td>Koden jag fick fungerade inte</td>
    <td>4 maj</td>
  </tr>
  <tr class="unread" onclick="viewMessage('Kristoffer Jonsson', 'Feedback p√• kundservice', 'Tack f√∂r snabb hj√§lp!', '3 maj')">
    <td>Kristoffer Jonsson</td>
    <td>Feedback p√• kundservice</td>
    <td>Tack f√∂r snabb hj√§lp!</td>
    <td>3 maj</td>
  </tr>
  <tr onclick="viewMessage('Elin Berg', 'Leveransproblem', 'Paketet fastnat i leverans', '2 maj')">
    <td>Elin Berg</td>
    <td>Leveransproblem</td>
    <td>Paketet fastnat i leverans</td>
    <td>2 maj</td>
  </tr>
  <tr onclick="viewMessage('Mattias Gustafsson', 'Fr√•ga om produktmaterial', '√Ñr tr√∂jan gjord i ekologisk bomull?', '1 maj')">
    <td>Mattias Gustafsson</td>
    <td>Fr√•ga om produktmaterial</td>
    <td>√Ñr tr√∂jan gjord i ekologisk bomull?</td>
    <td>1 maj</td>
  </tr>
</tbody>


  <!-- MODAL: Skicka meddelande -->
  <div id="messageModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeMessageModal()">&times;</span>
      <h2>Skicka meddelande till kund</h2>
      <form onsubmit="sendMessage(event)">
        <label for="customer">Kund:</label>
        <input type="text" id="customer" required placeholder="Ex. Anna Karlsson" />

        <label for="subject">√Ñmne:</label>
        <input type="text" id="subject" required placeholder="√Ñmne..." />

        <label for="message">Meddelande:</label>
        <textarea id="message" required placeholder="Skriv ditt meddelande h√§r..."></textarea>

        <button type="submit" class="send-btn">Skicka</button>
      </form>
    </div>
  </div>

  <!-- JS -->
  <script>
    const savedTheme = localStorage.getItem("theme") || "light";
    document.body.classList.add(`${savedTheme}-theme`);

    function openMessageModal() {
      document.getElementById("messageModal").style.display = "block";
    }

    function closeMessageModal() {
      document.getElementById("messageModal").style.display = "none";
    }

    async function sendMessage(e) {
  e.preventDefault();
  const name = document.getElementById("customer").value;
  const subject = document.getElementById("subject").value;
  const message = document.getElementById("message").value;

  // Testdata: Karta med namn till e-post (byt ut mot riktiga data senare)
  const emailMap = {
    "Anna Karlsson": "anna@example.com",
    "Johan Eriksson": "johan@example.com",
    "Sara Nilsson": "sara@example.com"
    // L√§gg till fler testkunder h√§r
  };

  const to = emailMap[name];
  if (!to) {
    alert("‚ö†Ô∏è Kunde inte hitta e-postadress f√∂r kunden.");
    return;
  }

  try {
    const res = await fetch('/api/email/send', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ to, subject, message })
    });

    const data = await res.json();
    if (data.success) {
      alert(`‚úÖ Meddelande till ${name} har skickats!`);
      closeMessageModal();
    } else {
      alert("‚ùå Det gick inte att skicka mejlet.");
    }
  } catch (err) {
    console.error('‚ùå Fel vid e-post:', err);
    alert("‚ùå N√•got gick fel vid mejlskick.");
  }
}

  </script>
  <script>
function viewMessage(name, subject, content, date) {
  const params = new URLSearchParams({
    name,
    subject,
    content,
    date
  });
  window.location.href = `kundmeddelande.html?${params.toString()}`;
}
</script>
</body>
</html>
